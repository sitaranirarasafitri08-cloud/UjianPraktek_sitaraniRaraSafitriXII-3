<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaraStudy - Pembelajaran & Kuis Lucu Bertema Peri Bibble</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Lucide Icons untuk ikon stiker yang lucu -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Menggunakan font Inter sebagai standar yang mudah dibaca */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* Latar belakang Awan Peri & Cahaya Bintang */
            background-color: #FCE4EC; /* Pink Sangat Pucat */
            background-image: linear-gradient(135deg, #F8BBD0 0%, #E1BEE7 50%, #FCE4EC 100%);
            color: #4A148C; /* Ungu Gelap */
        }
        .header-bg {
            background-color: #E91E63; /* Pink Fuchsia Cerah */
            background-image: linear-gradient(90deg, #E91E63 0%, #FF80AB 100%);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        .theme-button {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Animasi memantul lucu */
            border-radius: 9999px; 
            font-weight: 700;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .theme-button:hover:not(.active) {
            transform: scale(1.1);
            background-color: #F48FB1; /* Pink Muda */
            color: #4A148C; 
        }
        .theme-button.active {
            background-color: #FFFDE7; /* Kuning Bintang */
            color: #9C27B0; /* Ungu Ceria */
            border: 3px solid #FFEB3B;
            box-shadow: 0 4px 15px rgba(255, 235, 59, 0.7);
        }
        .card-bg {
            background-color: #FFFFFF;
            border-radius: 2rem; /* Sudut Super Bulat */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border: 4px solid #F48FB1; /* Garis Pink Peri */
            transform-origin: center;
        }
        /* Style untuk pilihan kuis yang lebih magis */
        .quiz-choice:checked + label {
            background-color: #E1BEE7 !important; /* Lavender Peri */
            border-color: #9C27B0 !important;
            box-shadow: 0 0 15px rgba(156, 39, 176, 0.5);
            transform: scale(1.02);
        }
        /* Animasi lucu untuk hasil */
        @keyframes jiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(-5deg); }
            75% { transform: rotate(3deg); }
        }
        .animate-jiggle {
            animation: jiggle 0.8s ease-in-out infinite;
        }
        @keyframes pop-in {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
        }
        .animate-pop-in {
            animation: pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Kontainer Utama Aplikasi -->
    <div id="app-container" class="flex flex-col flex-grow">
        
        <!-- Header Aplikasi -->
        <header class="header-bg p-4 sticky top-0 z-10">
            <div class="max-w-4xl mx-auto flex flex-col sm:flex-row justify-between items-center">
                <h1 class="text-3xl font-extrabold text-white mb-2 sm:mb-0 flex items-center">
                    <i data-lucide="wand-2" class="w-8 h-8 mr-2 text-yellow-300 transform rotate-45"></i>
                    RaraStudy Dunia Bibble
                </h1>
                <nav class="flex space-x-2 sm:space-x-3 mt-2 sm:mt-0">
                    <!-- Tombol Navigasi Utama -->
                    <button class="theme-button active px-3 py-2 text-sm sm:text-base bg-white text-gray-700" onclick="setView('home')">
                        <i data-lucide="sparkles" class="w-5 h-5 inline-block"></i>
                        <span class="hidden sm:inline"> Portal Peri</span>
                    </button>
                    <button id="nav-teka-teki" class="theme-button text-white px-3 py-2 text-sm sm:text-base" onclick="setView('puzzle')">
                        <i data-lucide="puzzle" class="w-5 h-5 inline-block"></i>
                        <span class="hidden sm:inline"> Teka-teki Sihir</span>
                    </button>
                    <button id="nav-belajar" class="theme-button text-white px-3 py-2 text-sm sm:text-base" onclick="setView('learning_subjects')">
                        <i data-lucide="gem" class="w-5 h-5 inline-block"></i>
                        <span class="hidden sm:inline"> Belajar Manis</span>
                    </button>
                    <button id="nav-kuis" class="theme-button text-white px-3 py-2 text-sm sm:text-base" onclick="setView('quiz_subjects')">
                        <i data-lucide="crown" class="w-5 h-5 inline-block"></i>
                        <span class="hidden sm:inline"> Kuis Ratu</span>
                    </button>
                </nav>
            </div>
        </header>

        <!-- Konten Utama (Berubah sesuai tampilan) -->
        <main id="main-content" class="flex-grow p-4 overflow-y-auto max-w-4xl w-full mx-auto">
            <!-- Konten akan dimuat di sini oleh JavaScript -->
        </main>

        <!-- Pesan Modal untuk Pemberitahuan (Lucu dan Bulat) -->
        <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-30 z-50 hidden items-center justify-center p-4">
            <div id="modal-content" class="card-bg p-8 max-w-sm w-full border-t-8 border-pink-500 transform transition duration-300">
                <h3 id="modal-title" class="text-2xl font-extrabold mb-3 text-gray-800 flex items-center"></h3>
                <p id="modal-message" class="text-gray-600 mb-6"></p>
                <div class="flex justify-end">
                    <button onclick="hideModal()" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-6 rounded-full transition duration-150 shadow-lg transform hover:scale-105">
                        <i data-lucide="heart" class="w-5 h-5 inline-block mr-1"></i> Oke Cantik!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Data Konten Aplikasi ---
        const contentData = {
            // Ikon Lucide Icons yang lucu dan cerah
            subjects: {
                matematika: { name: "Matematika (Aritmatika Peri)", icon: "bar-chart-3", color: "bg-blue-400", darkColor: "hover:bg-blue-500" },
                informatika: { name: "Informatika (Kode Sihir)", icon: "code", color: "bg-purple-400", darkColor: "hover:bg-purple-500" },
                jepang: { name: "Bahasa Jepang (Nihongo Manis)", icon: "feather", color: "bg-yellow-400", darkColor: "hover:bg-yellow-500" },
                akutansi: { name: "Akuntansi (Buku Emas)", icon: "wallet", color: "bg-green-400", darkColor: "hover:bg-green-500" },
                bahasa_indonesia: { name: "Bahasa Indonesia (Pesan Rahasia)", icon: "message-square", color: "bg-red-400", darkColor: "hover:bg-red-500" },
            },
            
            // Konten Teka-teki (25 soal bertema Bibble/Peri)
            puzzles: [
                { q: "Saya adalah peri kecil Bibble yang bisa terbang dan sering panik! Apa warna favorit saya? (Hint: Warna rambut Bibble)", a: "Ungu" },
                { q: "Jika Bibble memiliki 3 tongkat sihir dan kehilangan 1, berapa yang tersisa? (Tulis angka)", a: "2" },
                { q: "Lengkapi: 'Siapa nama teman Barbie yang selalu menyemangatinya dan percaya pada kekuatan...' (Hint: Dari mana peri Bibble berasal)", a: "Persahabatan" },
                { q: "Bibble sering mengucapkan kata lucu yang tidak bisa dipahami manusia. Apa nama kata tersebut?", a: "Bibblish" },
                { q: "Di film apa Bibble pertama kali muncul bersama Elina?", a: "Fairytopia" },
                ...Array(20).fill(0).map((_, i) => ({ q: `Teka-teki Sihir Lucu ke-${i + 6} (Temanya adalah Kerajaan Awan)`, a: `Jawaban Awan ${i + 6}` }))
            ],

            // Konten Belajar & Kuis (25 soal per subjek)
            questions: {
                matematika: {
                    learning: [
                        { q: "Jika ada 15 peri penjaga dan 5 pergi mencari bunga ajaib. Berapa peri yang tersisa? (15 - 5 = ?)", a: "10" },
                        { q: "Tongkat sihir Bibble menghasilkan 200 kilau per jam. Dalam 3 jam, berapa total kilau sihir yang dihasilkan? (200 x 3 = ?)", a: "600" },
                        { q: "Jika 4 mahkota peri dibagi rata untuk 8 orang, berapa bagian yang didapatkan setiap peri?", a: "0.5" },
                        { q: "Sebuah ramuan sihir membutuhkan 5 daun kupu-kupu dan 3 tetes embun. Jika ingin membuat 4 ramuan, berapa tetes embun yang dibutuhkan?", a: "12" },
                        { q: "Jumlah total sayap peri di RaraStudy adalah 50. Jika setiap peri memiliki 2 sayap, ada berapa peri?", a: "25" },
                        ...Array(20).fill(0).map((_, i) => ({ q: `Matematika Peri ke-${i + 6} (Persamaan Bintang)`, a: `Jawaban ${i + 6}` }))
                    ],
                    quiz: [
                        { q: "Sebuah mahkota ratu dihargai 100 koin ajaib. Jika Anda mendapat diskon 20%, berapa koin yang harus dibayar?", a: "80", choices: ["120", "80", "50", "90"] },
                        { q: "Sebuah lingkaran sihir memiliki diameter 14 cm. Berapa jari-jarinya?", a: "7 cm", choices: ["28 cm", "14 cm", "7 cm", "3.5 cm"] },
                        { q: "Lengkapi urutan ini: 1 (Peri Tunggal), 3 (Kelinci Ajaib), 5 (Bintang Sihir), 7 (....)", a: "Warna Pelangi", choices: ["Warna Pelangi", "Jam Terbang", "Gajah Kecil", "Topi Panjang"] },
                        { q: "Berapa hasil dari $5^3$?", a: "125", choices: ["15", "25", "100", "125"] }, 
                        { q: "Jika Bibble terbang sejauh 100 meter dalam 10 detik, berapa kecepatan rata-ratanya?", a: "10 m/s", choices: ["100 m/s", "10 m/s", "1 m/s", "50 m/s"] },
                        ...Array(20).fill(0).map((_, i) => ({ q: `Matematika Kuis ke-${i + 6} (Probabilitas Sihir)`, a: `Jawaban ${i + 6}`, choices: ["A", "B", "C", "D"] }))
                    ]
                },
                informatika: {
                    learning: [
                        { q: "Apa nama 'bahasa' yang paling dasar yang dipahami robot peri? (Biner/Binary).", a: "Biner" },
                        { q: "Dalam dunia sihir, apa 'perintah' pertama yang membuat tongkat berfungsi? (Power On/Nyalakan)", a: "Nyalakan" },
                        { q: "Apa nama struktur data yang hanya bisa diakses dari ujung (First-In, First-Out)?", a: "Queue" },
                        { q: "Jika 'Peri' = 001, 'Sihir' = 010. Berapakah 'Bibble' dalam kode biner 3 digit?", a: "011" },
                        { q: "Proses mengubah kode sihir program menjadi instruksi mesin peri disebut apa?", a: "Kompilasi" },
                        ...Array(20).fill(0).map((_, i) => ({ q: `Informatika Belajar ke-${i + 6} (Algoritma & Jaringan Sihir)`, a: `Jawaban ${i + 6}` }))
                    ],
                    quiz: [
                        { q: "Pilihan mana yang paling mendekati konsep 'Cloud Computing' (Awan Komputasi) dalam dunia peri?", a: "Kerajaan Awan", choices: ["Istana Kristal", "Kerajaan Awan", "Hutan Terlarang", "Danau Peri"] },
                        { q: "Apa nama perangkat keras utama yang bertindak sebagai 'Otak Bibble' komputer?", a: "CPU", choices: ["RAM", "Monitor", "CPU", "Hard Drive"] },
                        { q: "Ketika Anda 'mengunduh' resep ramuan, proses ini dalam jaringan disebut...", a: "Download", choices: ["Upload", "Download", "Streaming", "Encoding"] },
                        { q: "Apa kepanjangan dari URL?", a: "Uniform Resource Locator", choices: ["Universal Router Logic", "Uniform Resource Locator", "Unit Resource Link", "User Response Log"] },
                        { q: "Bahasa pemrograman apa yang sering digunakan untuk membuat halaman web yang interaktif?", a: "JavaScript", choices: ["Python", "C++", "Java", "JavaScript"] },
                        ...Array(20).fill(0).map((_, i) => ({ q: `Informatika Kuis ke-${i + 6} (Keamanan Data Sihir)`, a: `Jawaban ${i + 6}`, choices: ["A", "B", "C", "D"] }))
                    ]
                },
                jepang: {
                    learning: [
                        { q: "Apa arti dari 'Kira Kira' (きらきら) dalam Bahasa Jepang? (Ini seperti Kilauan)", a: "Berkilau/Berkilauan" },
                        { q: "Tuliskan 'Peri' dalam Romaji (Katakana: フェアリー)", a: "Fearī" },
                        { q: "Apa terjemahan dari 'Selamat Malam' dalam Bahasa Jepang?", a: "Konbanwa" },
                        { q: "Kata sifat 'cantik' (kirei) dalam bentuk Hiragana.", a: "きれい" },
                        { q: "Bagaimana cara mengucapkan angka 'tiga' (3) dalam Bahasa Jepang?", a: "San" },
                        ...Array(20).fill(0).map((_, i) => ({ q: `Jepang Belajar ke-${i + 6} (Kata Benda Ajaib)`, a: `Jawaban ${i + 6}` }))
                    ],
                    quiz: [
                        { q: "Manakah yang merupakan salam perpisahan yang sopan?", a: "Sayounara", choices: ["Arigatou", "Gomenasai", "Sayounara", "Ogenki desu ka"] },
                        { q: "Kanji untuk 'Bunga' (Flower), yang tumbuh di lembah peri:", a: "花", choices: ["木", "水", "花", "山"] },
                        { q: "Apa yang dimaksud dengan 'Kawaii' (かわいい)?", a: "Lucu/Imut", choices: ["Hebat/Kuat", "Lucu/Imut", "Galak/Marah", "Cepat/Laju"] },
                        { q: "Apa bahasa Jepang untuk 'Terima kasih'?", a: "Arigatou", choices: ["Gomenasai", "Arigatou", "Ohayou", "Konbanwa"] },
                        { q: "Huruf yang digunakan untuk menulis kata serapan (misalnya 'Bibble') adalah:", a: "Katakana", choices: ["Rōmaji", "Katakana", "Hiragana", "Kanji"] },
                        ...Array(20).fill(0).map((_, i) => ({ q: `Jepang Kuis ke-${i + 6} (Ungkapan Peri)`, a: `Jawaban ${i + 6}`, choices: ["A", "B", "C", "D"] }))
                    ]
                },
                akutansi: {
                    learning: [
                        { q: "Persamaan dasar akuntansi adalah: Harta (Aset) = Utang (Kewajiban) + ... (Harta Peri)", a: "Modal" },
                        { q: "Ketika Bibble menjual bubuk peri dan mendapatkan uang, ini disebut ... (Laba/Rugi)", a: "Laba" },
                        { q: "Apa yang dicatat di sisi kiri (debit) dalam akuntansi?", a: "Aset/Beban" },
                        { q: "Proses pencatatan transaksi koin ajaib secara kronologis disebut...", a: "Jurnal" },
                        { q: "Dokumen yang menunjukkan posisi keuangan Kastil Kristal pada tanggal tertentu adalah...", a: "Neraca" },
                        ...Array(20).fill(0).map((_, i) => ({ q: `Akuntansi Belajar ke-${i + 6} (Siklus Koin Ajaib)`, a: `Jawaban ${i + 6}` }))
                    ],
                    quiz: [
                        { q: "Peri menyimpan nektar bunga selama musim panas untuk musim dingin. Tindakan ini paling mendekati konsep...", a: "Aset", choices: ["Kewajiban", "Modal", "Aset", "Beban"] },
                        { q: "Peningkatan Modal pemilik Kastil disebut:", a: "Pendapatan", choices: ["Beban", "Kerugian", "Pendapatan", "Deviden"] },
                        { q: "Buku besar Kastil berisi kumpulan:", a: "Akun", choices: ["Jurnal", "Faktur", "Akun", "Memo"] },
                        { q: "Apa prinsip dasar yang menjamin bahwa Harta harus seimbang dengan Utang dan Modal?", a: "Keseimbangan", choices: ["Prinsip Biaya", "Keseimbangan", "Prinsip Konsistensi", "Prinsip Materialitas"] },
                        { q: "Pengeluaran koin untuk mendapatkan tongkat sihir yang akan memberikan manfaat di masa depan disebut...", a: "Investasi", choices: ["Beban", "Kerugian", "Pendapatan", "Investasi"] },
                        ...Array(20).fill(0).map((_, i) => ({ q: `Akuntansi Kuis ke-${i + 6} (Laporan Kastil)`, a: `Jawaban ${i + 6}`, choices: ["A", "B", "C", "D"] }))
                    ]
                },
                bahasa_indonesia: {
                    learning: [
                        { q: "Tuliskan kata baku dari 'bersih-bersih' (membersihkan).", a: "Membersihkan" },
                        { q: "Dalam kalimat 'Bibble sangat panik', kata 'sangat panik' termasuk jenis kata...", a: "Sifat (Adjektiva)" },
                        { q: "Apa antonim dari kata 'sihir' (Magic)?", a: "Nyata/Fakta" },
                        { q: "Imbuhan 'se-' pada kata 'seperi' (satu jenis peri) penulisannya dipisah atau digabung?", a: "Digabung" },
                        { q: "Apa fungsi utama dari konjungsi 'walaupun'?", a: "Menyatakan pertentangan/konsesi" },
                        ...Array(20).fill(0).map((_, i) => ({ q: `Bahasa Indonesia Belajar ke-${i + 6} (Ejaan & Tata Bahasa Peri)`, a: `Jawaban ${i + 6}` }))
                    ],
                    quiz: [
                        { q: "Manakah kalimat yang menggunakan kata benda kolektif yang sesuai dengan tema Bibble?", a: "Sekumpulan peri", choices: ["Segerombolan batu", "Sekumpulan peri", "Sejajar kursi", "Seuntai bunga"] },
                        { q: "Pola kalimat dasar yang paling umum adalah Subjek-Predikat (S-P). Manakah contohnya?", a: "Peri terbang", choices: ["Peri yang cantik", "Peri terbang", "Terbang peri", "Diperintah oleh peri"] },
                        { q: "Kata 'Kemudian' termasuk jenis kata apa dalam kalimat?", a: "Konjungsi", choices: ["Verba", "Adverbia", "Konjungsi", "Pronomina"] },
                        { q: "Manakah penulisan kata serapan yang benar?", a: "Fantasi", choices: ["Phantasy", "Fantasi", "Phantasi", "Fantasy"] },
                        { q: "Dalam teks, tujuan kalimat perintah (Misal: 'Terbanglah, Bibble!') adalah untuk...", a: "Memerintah", choices: ["Menerangkan", "Memengaruhi", "Mempertanyakan", "Memerintah"] },
                        ...Array(20).fill(0).map((_, i) => ({ q: `Bahasa Indonesia Kuis ke-${i + 6} (Tanda Baca Ajaib)`, a: `Jawaban ${i + 6}`, choices: ["A", "B", "C", "D"] }))
                    ]
                }
            }
        };

        // --- Variabel State (Sama seperti sebelumnya) ---
        let currentView = 'home';
        let currentSubject = null;
        let currentMode = null; 
        let currentQuestionIndex = 0;
        let quizScore = 0;
        let activeQuestions = [];

        const mainContent = document.getElementById('main-content');
        const navButtons = document.querySelectorAll('.theme-button');

        // --- Fungsi Utilitas ---
        function showModal(title, message, icon) {
            document.getElementById('modal-title').innerHTML = `<i data-lucide="${icon}" class="w-6 h-6 mr-2 text-pink-600"></i> ${title}`;
            document.getElementById('modal-message').textContent = message;
            lucide.createIcons();
            const modalContainer = document.getElementById('modal-container');
            const modalContent = document.getElementById('modal-content');
            
            modalContainer.classList.remove('hidden');
            modalContainer.classList.add('flex');
            modalContent.classList.add('animate-pop-in');
            
            setTimeout(() => {
                modalContent.classList.remove('animate-pop-in');
            }, 500);
        }

        function hideModal() {
            document.getElementById('modal-container').classList.remove('flex');
            document.getElementById('modal-container').classList.add('hidden');
        }

        function setActiveNav(view) {
            navButtons.forEach(btn => btn.classList.remove('active'));
            if (view === 'home') document.querySelector('button[onclick="setView(\'home\')"]').classList.add('active');
            else if (view.startsWith('puzzle')) document.getElementById('nav-teka-teki').classList.add('active');
            else if (view.includes('learning')) document.getElementById('nav-belajar').classList.add('active');
            else if (view.includes('quiz')) document.getElementById('nav-kuis').classList.add('active');
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- Fungsi Render Tampilan (Disesuaikan dengan style Bibble/Peri) ---
        function setView(view, subject = null, mode = null) {
            currentView = view;
            currentSubject = subject;
            currentMode = mode;
            currentQuestionIndex = 0;
            quizScore = 0;
            setActiveNav(view);
            mainContent.innerHTML = '';
            window.scrollTo(0, 0);

            switch (view) {
                case 'home':
                    renderHome();
                    break;
                case 'puzzle':
                    activeQuestions = contentData.puzzles;
                    renderPuzzle();
                    break;
                case 'learning_subjects':
                    renderSubjectSelection('learning');
                    break;
                case 'quiz_subjects':
                    renderSubjectSelection('quiz');
                    break;
                case 'start_session':
                    activeQuestions = contentData.questions[subject][mode];
                    shuffleArray(activeQuestions);
                    renderSession();
                    break;
                case 'result':
                    renderResult();
                    break;
                default:
                    renderHome();
            }
            lucide.createIcons();
        }

        function renderHome() {
            mainContent.innerHTML = `
                <div class="p-6 md:p-10 card-bg text-center mt-4">
                    <i data-lucide="crown" class="w-12 h-12 text-pink-600 mx-auto mb-4 animate-jiggle"></i>
                    <h2 class="text-3xl font-extrabold text-gray-800 mb-2">Selamat Datang, Peri Cantik!</h2>
                    <p class="text-gray-600 mb-6 font-medium">
                        Ayo mulai petualangan sihir RaraStudy bersama Bibble! Belajar Matematika, Informatika, Akuntansi, Bahasa Jepang, dan Bahasa Indonesia dengan penuh kilauan dan tawa.
                    </p>

                    <div class="grid md:grid-cols-3 gap-4 pt-4 border-t border-gray-100">
                        <button onclick="setView('puzzle')" class="text-center p-4 bg-purple-100 hover:bg-purple-300 text-purple-800 rounded-3xl transition duration-150 shadow-lg transform hover:scale-105">
                            <i data-lucide="puzzle" class="w-8 h-8 mx-auto mb-2"></i>
                            <span class="font-bold">25 Teka-teki Bibble</span>
                            <p class="text-sm">Asah otakmu dengan misteri peri!</p>
                        </button>
                        <button onclick="setView('learning_subjects')" class="text-center p-4 bg-pink-100 hover:bg-pink-300 text-pink-800 rounded-3xl transition duration-150 shadow-lg transform hover:scale-105">
                            <i data-lucide="gem" class="w-8 h-8 mx-auto mb-2"></i>
                            <span class="font-bold">Belajar Ceria</span>
                            <p class="text-sm">Baca dengan hati penuh bunga!</p>
                        </button>
                        <button onclick="setView('quiz_subjects')" class="text-center p-4 bg-blue-100 hover:bg-blue-300 text-blue-800 rounded-3xl transition duration-150 shadow-lg transform hover:scale-105">
                            <i data-lucide="zap" class="w-8 h-8 mx-auto mb-2"></i>
                            <span class="font-bold">Kuis Keajaiban</span>
                            <p class="text-sm">Uji 25 Soal, Dapatkan Mahkota!</p>
                        </button>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-100 text-center">
                        <h3 class="text-xl font-extrabold text-gray-800 mb-4 flex items-center justify-center">
                            <i data-lucide="wand-2" class="w-5 h-5 mr-2 text-pink-500"></i> Kata-kata Penyemangat dari Bibble!
                        </h3>
                        <blockquote class="italic text-gray-700 bg-purple-50 p-4 rounded-2xl border-l-4 border-purple-500 shadow-inner transform rotate-1">
                            "Yada yada-dada-doo! (Artinya: Jangan pernah takut mencoba, Peri!)" <br>
                            <span class="font-bold text-sm text-purple-600">- Bibble, Si Peri Lucu</span>
                        </blockquote>
                    </div>
                </div>
            `;
        }

        function renderPuzzle() {
            const total = activeQuestions.length;
            const currentQ = activeQuestions[currentQuestionIndex];

            if (currentQuestionIndex >= total) {
                mainContent.innerHTML = `
                    <div class="text-center p-8 card-bg border-4 border-yellow-300 transform rotate-2">
                        <i data-lucide="star" class="w-16 h-16 text-yellow-600 mx-auto mb-4 animate-spin"></i>
                        <h2 class="text-3xl font-extrabold text-gray-800 mb-4">Yeay! Teka-teki Selesai!</h2>
                        <p class="text-gray-600 mb-8">Anda telah menyelesaikan semua ${total} Teka-teki Sihir. Hebat! Anda layak mendapatkan sayap baru!</p>
                        <button onclick="setView('home')" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-full transition duration-150 shadow-lg transform hover:scale-105">
                            <i data-lucide="sparkles" class="w-5 h-5 inline-block mr-1"></i> Kembali ke Portal Peri
                        </button>
                    </div>
                `;
                return;
            }

            mainContent.innerHTML = `
                <div class="card-bg p-6">
                    <h2 class="text-2xl font-extrabold text-pink-600 mb-4 flex items-center">
                        <i data-lucide="puzzle" class="w-7 h-7 mr-2"></i> Teka-teki Bibble #${currentQuestionIndex + 1}
                    </h2>
                    <div class="mb-4 text-sm font-bold text-gray-500">
                        Soal ${currentQuestionIndex + 1} dari ${total}
                    </div>
                    
                    <div class="p-5 bg-purple-50 border-2 border-purple-300 rounded-xl mb-6 shadow-md transform rotate-[-1deg]">
                        <p class="text-xl font-bold text-gray-800">${currentQ.q}</p>
                    </div>

                    <label for="puzzle-answer" class="block text-sm font-bold text-gray-700 mb-2">Jawaban Sihir Anda:</label>
                    <input type="text" id="puzzle-answer" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 mb-4 transition duration-150" placeholder="Ketik jawabannya di sini...">
                    <div id="puzzle-feedback" class="mb-4 font-semibold"></div>

                    <button onclick="checkPuzzleAnswer('${currentQ.a}')" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 rounded-full transition duration-150 shadow-lg transform hover:scale-105">
                        <i data-lucide="magic-wand" class="w-5 h-5 inline-block mr-1"></i> Cek Keajaibannya!
                    </button>
                </div>
            `;
        }

        function checkPuzzleAnswer(correctAnswer) {
            const input = document.getElementById('puzzle-answer');
            const userAnswer = input.value.trim();
            const normalizedUser = userAnswer.toLowerCase().replace(/\s/g, '');
            const normalizedCorrect = correctAnswer.toLowerCase().replace(/\s/g, '');

            if (normalizedUser === normalizedCorrect) {
                showModal('Benar Sekali!', 'Wow, Anda memiliki sihir pengetahuan! Jawabannya adalah: ' + correctAnswer, 'wand-2');
                currentQuestionIndex++;
                setTimeout(() => setView('puzzle'), 1500); 
                input.value = '';
            } else {
                showModal('Oh, Hampir!', 'Jawabannya masih terkunci di Kastil Kristal. Coba ingat lagi filmnya!', 'message-square-error');
            }
        }

        function renderSubjectSelection(mode) {
            currentMode = mode;
            const title = mode === 'learning' ? 'Pilih Kelas Belajar Manis' : 'Pilih Arena Kuis Ratu (25 Soal)';
            const icon = mode === 'learning' ? 'book-open-check' : 'crown';
            const actionText = mode === 'learning' ? 'Mulai Terbang' : 'Mulai Tanding';

            let html = `
                <div class="card-bg p-6">
                    <h2 class="text-2xl font-extrabold text-gray-800 mb-6 flex items-center">
                        <i data-lucide="${icon}" class="w-7 h-7 mr-2 text-purple-600"></i> ${title}
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            `;

            for (const key in contentData.subjects) {
                const subject = contentData.subjects[key];
                html += `
                    <button onclick="setView('start_session', '${key}', '${mode}')" 
                            class="p-4 rounded-3xl text-white font-bold transition duration-150 shadow-xl transform hover:scale-[1.05] ${subject.color} ${subject.darkColor} flex flex-col items-center justify-center h-32">
                        <i data-lucide="${subject.icon}" class="w-10 h-10 mb-2"></i>
                        <span class="block text-lg text-center">${subject.name}</span>
                        <span class="block text-sm font-normal mt-1 opacity-80">${actionText}</span>
                    </button>
                `;
            }

            html += `
                    </div>
                </div>
            `;
            mainContent.innerHTML = html;
        }

        function renderSession() {
            const total = activeQuestions.length;
            const currentQ = activeQuestions[currentQuestionIndex];
            const subject = contentData.subjects[currentSubject];

            const modeTitle = currentMode === 'learning' ? 'Sesi Belajar Kilau' : 'Sesi Kuis Peri Cantik';
            const modeIcon = currentMode === 'learning' ? 'gem' : 'sparkles';
            const buttonText = currentMode === 'learning' ? 'Lihat Jawaban Ajaibnya!' : 'Kirim Jawaban Lucu';

            if (!currentQ) {
                setView('result');
                return;
            }

            let inputArea = '';

            if (currentMode === 'learning') {
                inputArea = `
                    <label for="session-answer" class="block text-sm font-bold text-gray-700 mb-2">Jawaban Tebakan Anda:</label>
                    <input type="text" id="session-answer" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 mb-4 transition duration-150" placeholder="Coba jawab dulu sebelum lihat kunci...">
                    <div id="session-feedback" class="mb-4 font-semibold"></div>
                    <button onclick="checkLearningAnswer('${currentQ.a}')" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 rounded-full transition duration-150 shadow-lg transform hover:scale-105">
                        ${buttonText}
                    </button>
                `;
            } else {
                let choicesHtml = '';
                let choices = [...currentQ.choices];
                shuffleArray(choices); 

                choices.forEach((choice, index) => {
                    const optionId = `choice-${index}`;
                    choicesHtml += `
                        <div class="mb-2">
                            <input type="radio" id="${optionId}" name="quiz-choice" value="${choice}" class="hidden peer quiz-choice">
                            <label for="${optionId}" class="block w-full p-3 border-2 border-gray-300 rounded-xl cursor-pointer transition duration-150 hover:bg-gray-50 font-bold text-gray-700">
                                <span class="mr-2 text-pink-500">${String.fromCharCode(65 + index)}.</span> ${choice}
                            </label>
                        </div>
                    `;
                });
                
                inputArea = `
                    <div class="space-y-2 mb-4">
                        ${choicesHtml}
                    </div>
                    <div id="session-feedback" class="mb-4 font-semibold"></div>
                    <button onclick="checkQuizAnswer('${currentQ.a}')" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 rounded-full transition duration-150 shadow-lg transform hover:scale-105">
                        ${buttonText}
                    </button>
                `;
            }

            mainContent.innerHTML = `
                <div class="card-bg p-6">
                    <h2 class="text-2xl font-extrabold text-gray-800 mb-2 flex items-center">
                        <i data-lucide="${modeIcon}" class="w-7 h-7 mr-2 text-purple-600"></i> ${modeTitle}: ${subject.name}
                    </h2>
                    <div class="text-sm font-bold text-gray-500 mb-4 flex justify-between">
                        <span>Soal ${currentQuestionIndex + 1} dari ${total}</span>
                        ${currentMode === 'quiz' ? `<span class="text-red-500">Skor: ${quizScore}</span>` : ''}
                    </div>
                    
                    <div class="p-5 bg-pink-50 border-2 border-pink-300 rounded-xl mb-6 shadow-md transform rotate-[1deg]">
                        <p class="text-xl font-bold text-gray-800">${currentQ.q}</p>
                    </div>

                    ${inputArea}
                    
                    <button onclick="setView('${currentMode}_subjects')" class="w-full mt-4 text-sm text-gray-500 hover:text-gray-700 font-bold">
                        <i data-lucide="chevrons-left" class="w-4 h-4 inline-block"></i> Ganti Kelas Belajar Lucu
                    </button>
                </div>
            `;
        }
        
        function checkLearningAnswer(correctAnswer) {
            const input = document.getElementById('session-answer');
            const feedback = document.getElementById('session-feedback');
            const userAnswer = input.value.trim();
            const normalizedUser = userAnswer.toLowerCase().replace(/\s/g, '');
            const normalizedCorrect = correctAnswer.toLowerCase().replace(/\s/g, '');

            if (normalizedUser === normalizedCorrect) {
                feedback.innerHTML = '<span class="text-green-600 bg-green-100 p-2 rounded-lg block"><i data-lucide="check" class="w-4 h-4 inline-block mr-1"></i> TEPAT SEPERTI SIHIR! Lanjut ya...</span>';
                currentQuestionIndex++;
                setTimeout(() => renderSession(), 1500);
            } else {
                feedback.innerHTML = `
                    <span class="text-red-600 bg-red-100 p-2 rounded-lg block">
                        <i data-lucide="x" class="w-4 h-4 inline-block mr-1"></i> Ups, salah. Jawaban ajaibnya adalah: <span class="font-bold underline">${correctAnswer}</span>. Next!
                    </span>`;
                currentQuestionIndex++;
                setTimeout(() => renderSession(), 5000);
            }
            lucide.createIcons();
        }

        function checkQuizAnswer(correctAnswer) {
            const selected = document.querySelector('input[name="quiz-choice"]:checked');
            
            if (!selected) {
                showModal('Aduh!', 'Pilih dulu salah satu jawaban, jangan melamun tentang peri ya!', 'message-square-error');
                return;
            }

            const userAnswer = selected.value;
            if (userAnswer === correctAnswer) {
                quizScore++;
                showModal('Skor Bertambah!', 'Jawaban Anda BERKILAU! Keren!', 'star');
            } else {
                showModal('Eits, Belum Tepat!', `Jawaban yang benar seharusnya: ${correctAnswer}. Coba lagi nanti, Peri!`, 'bomb');
            }

            currentQuestionIndex++;
            
            // Lanjut setelah modal ditutup
            const proceed = () => {
                hideModal();
                renderSession();
                document.getElementById('modal-container').onclick = hideModal;
            };

            document.getElementById('modal-container').onclick = proceed;
            document.getElementById('modal-content').onclick = (e) => e.stopPropagation();
            
            // Langsung lanjut jika pengguna menekan tombol "Oke Cantik!" di modal
            document.querySelector('#modal-content button').onclick = proceed; 
        }

        function renderResult() {
            const total = activeQuestions.length;
            const percentage = ((quizScore / total) * 100).toFixed(1);
            const passed = percentage >= 70; // Batas kelulusan 70%
            const color = passed ? 'pink' : 'purple';
            const message = passed ? 
                'MAHA KARYA! Anda sungguh Ratu Peri Pengetahuan. Bibble bangga!' : 
                'Tidak apa-apa, Peri Cantik! Sayap Anda akan semakin kuat setelah mencoba lagi. Ulangi kuis ini untuk mendapatkan Mahkota Ratu!';

            mainContent.innerHTML = `
                <div class="text-center p-8 card-bg border-t-8 border-${color}-500 transform rotate-1">
                    <i data-lucide="sparkles" class="w-16 h-16 text-${color}-600 mx-auto mb-4 animate-jiggle"></i>
                    <h2 class="text-3xl font-extrabold text-gray-800 mb-2">PENGUMUMAN HASIL SIHIR!</h2>
                    <p class="text-xl text-gray-700 mb-4">Kelas: ${contentData.subjects[currentSubject].name}</p>
                    
                    <div class="inline-block p-4 bg-${color}-100 rounded-3xl shadow-xl mb-6 border-4 border-${color}-300 transform rotate-[-2deg]">
                        <p class="text-5xl font-extrabold text-${color}-700">${quizScore}</p>
                        <p class="text-lg font-bold text-gray-600">dari ${total} Soal Benar!</p>
                        <p class="text-2xl font-extrabold text-${color}-500">(${percentage}%)</p>
                    </div>

                    <p class="text-gray-600 mb-8 font-medium">${message}</p>
                    
                    <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                        <button onclick="setView('quiz_subjects')" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full transition duration-150 shadow-lg transform hover:scale-105">
                            <i data-lucide="rotate-ccw" class="w-5 h-5 inline-block mr-1"></i> Coba Lagi Dikit!
                        </button>
                        <button onclick="setView('home')" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-full transition duration-150 shadow-lg transform hover:scale-105">
                            <i data-lucide="wand-2" class="w-5 h-5 inline-block mr-1"></i> Pulang ke Portal Peri
                        </button>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // --- Inisialisasi Aplikasi ---
        window.onload = () => {
            setView('home');
            lucide.createIcons();
            
            // Atur ulang penanganan klik modal
            document.getElementById('modal-container').onclick = hideModal;
            document.getElementById('modal-content').onclick = (e) => e.stopPropagation();
        };

    </script>
</body>
</html>
